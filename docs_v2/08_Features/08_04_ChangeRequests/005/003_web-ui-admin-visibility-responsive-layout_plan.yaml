<!-- docs_v2/08_Features/08_04_ChangeRequests/005/003_web-ui-admin-visibility-responsive-layout_plan.yaml -->
version: 1
feature_id: web-interface-mvp-change-005-003-admin-visibility-responsive-layout
summary: "Make the web UI responsive and hide admin-only controls and activity sections for non-admin users, with a clear modal-based admin login flow and short-lived admin sessions."
design_refs:
  - docs_v2/08_Features/08_04_ChangeRequests/005/003_web-ui-admin-visibility-responsive-layout_design.md
  - docs_v2/08_Features/08_02_Feature_Design/005_web-interface-mvp_design.md
repo_constraints:
  allowed_paths:
    - "publisher_v2/src/publisher_v2/**"
    - "publisher_v2/tests/**"
    - "docs_v2/**"
  excluded_paths:
    - "code_v1/**"
    - "docs_v1/**"
    - "htmlcov/**"
    - "coverage.xml"
    - "coverage-current.xml"
acceptance_criteria:
  - "Non-admin users who open the web UI do not see admin or status/administration sections, and the Analyze & Caption and Publish buttons are not rendered."
  - "When an admin successfully logs in via the modal, admin and status/administration sections appear, Analyze & Caption and Publish become visible and enabled, and the page background switches to a dark red admin-mode theme."
  - "When an admin logs out (or their admin session expires), admin-only UI elements are hidden again, Analyze & Caption and Publish are no longer shown, and the background returns to the non-admin theme."
  - "The Activity section shows only the current or most recent action and its state (e.g., Analyzing…, Analysis complete, Publishing…, Publish complete) rather than an unbounded history, and remains readable on mobile layouts."
non_goals:
  - "Introducing new authentication mechanisms, auth backends, or RBAC systems beyond the existing admin/not-admin model."
  - "Changing underlying publishing or analysis workflows, AI prompts, or Dropbox/storage behavior."
  - "Modifying CLI behavior or adding new server-side persistence layers or databases."
  - "Implementing multi-user roles or granular permissions beyond a single admin/not-admin distinction."
tasks:
  - id: web_story005_003.update_web_template_layout
    type: code
    touches:
      - "publisher_v2/src/publisher_v2/web/templates/index.html"
    files_out: []
    contracts:
      signatures:
        - "initLayout(): void"
        - "setActivity(message: string): void"
    depends_on: []
  - id: web_story005_003.wire_admin_modal_and_state
    type: code
    touches:
      - "publisher_v2/src/publisher_v2/web/templates/index.html"
    files_out: []
    contracts:
      signatures:
        - "initAdminControls(): void"
        - "fetchAdminStatus(): Promise<boolean>"
        - "updateAdminState(isAdmin: boolean): void"
    depends_on:
      - "web_story005_003.update_web_template_layout"
  - id: web_story005_003.add_web_admin_visibility_tests
    type: test
    touches: []
    files_out:
      - "publisher_v2/tests/test_web_admin_visibility.py"
    contracts:
      signatures:
        - "test_admin_sections_hidden_for_non_admin(client): None"
        - "test_admin_sections_visible_after_login(client): None"
        - "test_activity_section_shows_latest_action_only(client): None"
    depends_on:
      - "web_story005_003.wire_admin_modal_and_state"
  - id: web_story005_003.update_feature_docs
    type: doc
    touches:
      - "docs_v2/08_Features/08_02_Feature_Design/005_web-interface-mvp_design.md"
    files_out: []
    contracts: {}
    depends_on:
      - "web_story005_003.wire_admin_modal_and_state"
quality_gates:
  tests_required:
    - "web_story005_003.add_web_admin_visibility_tests"
  coverage_delta_min: +1
  perf_budget:
    web_ui_root_p95_ms: 200
  security_checks:
    - "dep-audit"
    - "no-secrets"
    - "lint"
release:
  strategy: "gradual"
  flags:
    - "features.web_interface_mvp_admin_visibility_responsive_layout"
  metrics:
    - "web_ui_requests_total"
    - "web_ui_error_rate"
    - "web_ui_admin_actions"


