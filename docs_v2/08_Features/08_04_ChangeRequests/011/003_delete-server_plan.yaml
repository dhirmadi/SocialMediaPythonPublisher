<!-- docs_v2/08_Features/08_04_ChangeRequests/011/003_delete-server_plan.yaml -->

version: 1
feature_id: heroku-hetzner-app-cloning
story_id: delete-server
summary: "Add a delete action to heroku_hetzner_clone.py to remove a server by name, cleaning up Heroku, Hetzner DNS, and servers.txt."
design_refs:
  - docs_v2/08_Features/08_04_ChangeRequests/011/003_delete-server_design.md
repo_constraints:
  allowed_paths:
    - scripts/**
    - docs_v2/**
  excluded_paths:
    - code_v1/**
    - docs_v1/**
    - htmlcov/**
    - coverage.xml
    - coverage-current.xml

acceptance_criteria:
  - "Given scripts/servers.txt contains an entry for name X, running heroku_hetzner_clone.py --action delete --name X deletes the Heroku app(s), removes the Hetzner CNAME(s), and removes the entry from scripts/servers.txt."
  - "Given the same command with --dry-run, no external deletions occur and scripts/servers.txt is not modified."

tasks:
  - id: delete_server.extend_cli_action
    type: code
    touches:
      - scripts/heroku_hetzner_clone.py
    files_out: []
    contracts:
      request: {}
      response: {}
      signatures:
        - "def parse_args("
    depends_on: []
    rollback: "Remove the --action argument and revert to create-only behavior."

  - id: delete_server.add_helpers
    type: code
    touches:
      - scripts/heroku_hetzner_clone.py
    files_out: []
    contracts:
      request: {}
      response: {}
      signatures:
        - "def _parse_app_name_from_heroku_url("
        - "def _delete_server_by_name("
        - "def delete_app("
        - "def delete_record("
    depends_on:
      - delete_server.extend_cli_action
    rollback: "Remove the delete helpers and any calls to them."

  - id: delete_server.integrate_flow
    type: code
    touches:
      - scripts/heroku_hetzner_clone.py
    files_out: []
    contracts:
      request: {}
      response: {}
      signatures:
        - "def main("
    depends_on:
      - delete_server.add_helpers
    rollback: "Remove the delete branch from main() and any references to delete-server helpers."

quality_gates:
  tests_required: []
  coverage_delta_min: 0
  perf_budget: {}
  security_checks:
    - no-secrets

release:
  strategy: direct
  flags: []
  migration_notes:
    - "Operators can now use --action delete --name <name> to clean up apps and DNS entries created previously and logged in scripts/servers.txt."


