version: 1
feature_id: keep-remove-curation
story_id: 02_web_integration
summary: "Integrate Keep/Remove curation into the V2 Web Service, API, and UI, enabling authenticated admins to curate images via the browser."
design_refs:
  - docs_v2/08_Features/08_02_Feature_Design/010_keep-remove-curation_design.md
repo_constraints:
  allowed_paths:
    - publisher_v2/src/publisher_v2/**
    - publisher_v2/tests/**
    - docs_v2/**

acceptance_criteria:
  - "Given an authenticated admin viewing an image in the web UI with FEATURE_KEEP_CURATE=true, when they click Keep, then the image is moved via the backend and the UI advances to the next image."
  - "Given an authenticated admin viewing an image in the web UI with FEATURE_REMOVE_CURATE=true, when they click Remove, then the image is moved to the remove/reject folder and no longer appears."
  - "Given FEATURE_KEEP_CURATE=false or FEATURE_REMOVE_CURATE=false, when the web UI loads, then the corresponding curation buttons are hidden."
  - "Given unauthenticated access or non-admin user, when curation endpoints are called, then the API returns 401 or 403."

tasks:
  # 1. Web service & API
  - id: keep_remove.extend_web_models
    type: code
    touches:
      - publisher_v2/src/publisher_v2/web/models.py
    files_out: []
    contracts:
      signatures:
        - "class CurationResponse(BaseModel)"

  - id: keep_remove.extend_web_service
    type: code
    touches:
      - publisher_v2/src/publisher_v2/web/service.py
    files_out: []
    contracts:
      signatures:
        - "class WebImageService"
        - "async def keep_image(self, filename: str) -> CurationResponse"
        - "async def remove_image(self, filename: str) -> CurationResponse"
    depends_on:
      - keep_remove.extend_web_models

  - id: keep_remove.extend_web_app_endpoints
    type: code
    touches:
      - publisher_v2/src/publisher_v2/web/app.py
    files_out: []
    contracts:
      signatures:
        - "@app.post('/api/images/{filename}/keep')"
        - "@app.post('/api/images/{filename}/remove')"
        - "@app.get('/api/config/features')"
    depends_on:
      - keep_remove.extend_web_service

  # 2. Web UI template & JS
  - id: keep_remove.update_web_index_template
    type: code
    touches:
      - publisher_v2/src/publisher_v2/web/templates/index.html
    files_out: []
    contracts:
      signatures:
        - "id=\"btn-keep\""
        - "id=\"btn-remove\""
        - "async function apiKeep()"
        - "async function apiRemove()"
    depends_on:
      - keep_remove.extend_web_app_endpoints

  # 3. Configuration docs
  - id: keep_remove.update_configuration_docs
    type: doc
    touches:
      - docs_v2/05_Configuration/CONFIGURATION.md
    files_out: []

  # Tests
  - id: keep_remove.tests_web_service
    type: test
    touches: []
    files_out:
      - publisher_v2/tests/web/test_web_keep_remove_service.py

  - id: keep_remove.tests_web_endpoints_admin
    type: test
    touches: []
    files_out:
      - publisher_v2/tests/web_integration/test_web_keep_remove_endpoints.py

quality_gates:
  tests_required:
    - keep_remove.tests_web_service
    - keep_remove.tests_web_endpoints_admin

