version: 1
feature_id: keep-remove-curation
story_id: 03_proactive_folder_creation
summary: "Proactively check and create Keep/Remove curation folders upon successful admin login to ensure system readiness."
design_refs:
  - docs_v2/08_Epics/08_02_Feature_Design/010_keep-remove-curation_design.md
repo_constraints:
  allowed_paths:
    - publisher_v2/src/publisher_v2/**
    - publisher_v2/tests/**
    - docs_v2/**

acceptance_criteria:
  - "Given the Keep/Remove feature is enabled, when an admin logs in successfully, then the application verifies that the configured 'keep' and 'remove' folders exist in Dropbox, creating them if necessary."
  - "Given the folders already exist, when the check runs, then no error occurs and the folders remain untouched."
  - "Given the feature is disabled, when an admin logs in, then no folder checks are performed."
  - "Given a storage error during folder verification (e.g. Dropbox down), when an admin logs in, then the login succeeds but a warning is logged (non-blocking)."

tasks:
  # 1. Storage Layer
  - id: keep_remove.add_ensure_folder
    type: code
    touches:
      - publisher_v2/src/publisher_v2/services/storage.py
    files_out: []
    contracts:
      signatures:
        - "async def ensure_folder_exists(self, folder_path: str) -> None"

  # 2. Web Service
  - id: keep_remove.add_verify_curation_folders
    type: code
    touches:
      - publisher_v2/src/publisher_v2/web/service.py
    files_out: []
    contracts:
      signatures:
        - "async def verify_curation_folders(self) -> None"

  # 3. Web Endpoint
  - id: keep_remove.integrate_login_verification
    type: code
    touches:
      - publisher_v2/src/publisher_v2/web/app.py
    files_out: []
    contracts:
      signatures:
        - "async def api_admin_login(payload: AdminLoginRequest, response: Response, service: WebImageService = Depends(get_service)) -> AdminStatusResponse"
    depends_on:
      - keep_remove.add_verify_curation_folders

  # Tests
  - id: keep_remove.tests_proactive_creation
    type: test
    touches: []
    files_out:
      - publisher_v2/tests/web/test_web_admin_login_folder_check.py

quality_gates:
  tests_required:
    - keep_remove.tests_proactive_creation

